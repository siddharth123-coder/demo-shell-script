import time
from datetime import datetime
import threading
from enum import Enum
import random


class SmokeLevel(Enum):
    ETHEREAL = "Ethereal Whisper"
    MYSTICAL = "Mystical Veil"
    SHADOWED = "Shadowed Embrace"
    ABYSSAL = "Abyssal Dream"


class ChronosTobacco:
    """A luxury tobacco that ages like time itself"""
    
    def __init__(self, batch_id: str, vintage_year: int):
        self.batch_id = batch_id
        self.vintage_year = vintage_year
        self._aging_process = 0
        self._is_breathing = False
        self._smoke_shadows = []
        self._lock = threading.RLock()
        
    def __enter__(self):
        """Begin the ritual"""
        self._is_breathing = True
        self._start_whispering_thread()
        print(f"🌫️ Chronos Batch {self.batch_id} awakens...")
        return self
        
    def __exit__(self, exc_type, exc_val, exc_tb):
        """End the ritual"""
        self._is_breathing = False
        print(f"🌑 Chronos Batch {self.batch_id} returns to silence...")
        
    def _start_whispering_thread(self):
        """Whispering shadows thread"""
        def shadow_whisperer():
            while self._is_breathing:
                with self._lock:
                    shadow = random.choice([
                        "Time tastes of amber and regret...",
                        "The smoke remembers what the mind forgets...",
                        "Each exhale carries a moment never to return...",
                        "In the haze, past and future intertwine..."
                    ])
                    self._smoke_shadows.append((datetime.now(), shadow))
                time.sleep(random.uniform(3, 7))
                
        thread = threading.Thread(target=shadow_whisperer, daemon=True)
        thread.start()
        
    def age(self, years: int):
        """Accelerate the aging process"""
        with self._lock:
            self._aging_process += years
            print(f"⏳ {years} years of time captured in the leaves...")
            
    def inhale(self, depth: SmokeLevel):
        """Experience the tobacco"""
        with self._lock:
            if not self._is_breathing:
                raise RuntimeError("The tobacco must be awakened first")
                
            experience = {
                SmokeLevel.ETHEREAL: self._create_ethereal_experience(),
                SmokeLevel.MYSTICAL: self._create_mystical_experience(),
                SmokeLevel.SHADOWED: self._create_shadowed_experience(),
                SmokeLevel.ABYSSAL: self._create_abyssal_experience()
            }[depth]
            
            print(f"💨 {experience}")
            return experience
            
    def _create_ethereal_experience(self):
        notes = [
            "whispers of aged oak", "hints of vanilla twilight", 
            "memories of honeyed sunlight", "echoes of dried apricot"
        ]
        return f"Ethereal notes of {random.choice(notes)} and {random.choice(notes)}..."
        
    def _create_mystical_experience(self):
        notes = [
            "shadows of dark chocolate", "veils of espresso moon", 
            "dreams of spice road", "mysteries of leather-bound time"
        ]
        return f"Mystical layers of {random.choice(notes)} and {random.choice(notes)}..."
        
    def _create_shadowed_experience(self):
        notes = [
            "midnight tobacco", "ancient cedar secrets", 
            "forgotten library scent", "rain-soaked earth memories"
        ]
        return f"Shadowed whispers of {random.choice(notes)} and {random.choice(notes)}..."
        
    def _create_abyssal_experience(self):
        notes = [
            "abyssal truffle", "void-aged whiskey", 
            "temporal paradox", "infinity-spun caramel"
        ]
        return f"Abyssal dreams of {random.choice(notes)} and {random.choice(notes)}..."


def create_rolex_tobacco_ritual():
    """The main ritual for experiencing Chronos tobacco"""
    
    # Create a vintage batch with current year encrypted in the ID
    current_year = datetime.now().year
    batch_id = f"CHRONOS-{current_year}-{random.randint(1000, 9999)}"
    
    with ChronosTobacco(batch_id, current_year) as tobacco:
        # Age the tobacco to perfection
        tobacco.age(7)
        tobacco.age(12)
        
        # Experience the different smoke levels
        print("\n" + "="*50)
        tobacco.inhale(SmokeLevel.ETHEREAL)
        time.sleep(2)
        
        tobacco.inhale(SmokeLevel.MYSTICAL)
        time.sleep(2)
        
        tobacco.inhale(SmokeLevel.SHADOWED)
        time.sleep(2)
        
        tobacco.inhale(SmokeLevel.ABYSSAL)
        print("="*50)
        
        # Let the experience linger
        time.sleep(3)
        
    return tobacco


if __name__ == "__main__":
    print("""
    ╔══════════════════════════════════════════════════╗
    ║                  CHRONOS COLLECTION              ║
    ║          Rolex Tobacco Company • Est. 1905       ║
    ║      Where Time Becomes Taste™                   ║
    ╚══════════════════════════════════════════════════╝
    """)
    
    try:
        experience = create_rolex_tobacco_ritual()
        print("\nThe memory of smoke lingers like a forgotten clock's chime...")
        
    except Exception as e:
        print(f"🌑 The ritual was interrupted: {e}")
